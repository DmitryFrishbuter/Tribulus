language: objective-c
osx_image: xcode8.3

env:
    global:
    - PROJECT=Tribulus.xcodeproj
    - IOS_FRAMEWORK_SCHEME="Tribulus"
    - IOS_SDK=iphonesimulator10.3.1
    matrix:
    - DESTINATION="platform=iOS Simulator,OS=10.3.1,name=iPhone 7"     SCHEME="$IOS_FRAMEWORK_SCHEME"
    
notifications:
    slack: travis-rosberry:MzKmgUnDtHBzXZOTWSuTcB7M
    email: false
    
before_script:
  gem install github_changelog_generator

script: 
  - set -o pipefail
  - > 
      xcodebuild
      -project "$PROJECT"
      -scheme "$IOS_FRAMEWORK_SCHEME"
      -destination "$DESTINATION"
      -enableCodeCoverage YES build test | xcpretty -c --test --color

after_success:
  - bash <(curl -s https://codecov.io/bash) -cF ios
  - >
      github_changelog_generator --token "$CHANGELOG_GITHUB_TOKEN"
      -u Dmitry Frishbuter 
      -p Tribulus
      github_changelog_generator 
      DmitryFrishbuter/Tribulus
  - git checkout -b master
  - git add . CHANGELOG.md
  - git commit -a -m "Travis build: $TRAVIS_BUILD_NUMBER"
  - git remote add origin https://"$GITHUB_OAUTH_TOKEN"@github.com/DmitryFrishbuter/Tribulus.git
  - git push --quiet -u origin master
  
deploy:
    provider: releases
    api_key: $GITHUB_OAUTH_TOKEN
    skip_cleanup: true
    on:
      tags: true
